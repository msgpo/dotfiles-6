#!/bin/sh
set -e

if [ -z "$1" ]; then
  echo "usage: aur-release <package-name>" >&2
  exit 64
fi

name=$1
aur_repo=ssh://aur@aur.archlinux.org/$name

tmp=$(mktemp -d)
trap 'rm -r $tmp' EXIT

git clone "$aur_repo" "$tmp"
cd "$tmp"

echo "Launching shell in AUR package clone. ^D or exit when done."
"$SHELL"

printf "Continue? [y/n] "
read -r ans; [ "$ans" != y ] && exit 1

updpkgsums
mksrcinfo

echo "Performing test installation..."
makepkg --syncdeps --install --force

echo "Updating metadata..."
git add .SRCINFO PKGBUILD

git commit
git push
