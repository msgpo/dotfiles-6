#!/bin/sh
#
# pbrisbin 2015 - prune branches already merged into master
#
###
set -e

if ! git branch | grep -q '^\* master$'; then
  git checkout --quiet master
fi

echo ":: Updating master"
git pull

echo ":: Rebasing local branches"
git branch | grep -v '^\* master$' | while read -r branch; do
  git checkout --quiet "$branch"
  git rebase master >/dev/null 2>&1 || git rebase --abort
done

git checkout --quiet master

echo ":: Deleting merged branches"
git branch --merged master | grep -v '^\* master$' | while read -r branch; do
  git branch --delete "$branch"
  git branch --delete --remote "origin/$branch" 2>/dev/null || true
done
